# auto-generated by grc.converter

id: ettus_rfnoc_streamer_dma_fifo
label: 'RFNoC: DmaFIFO'

parameters:
-   id: num_chans
    label: Num Channels
    dtype: int
    default: '1'
    options: ['1', '2']
    hide: part
-   id: type
    label: Host Data Type
    dtype: enum
    options: [fc32, sc16, u8, item32]
    option_labels: [Complex float32, Complex int16, Byte, VITA word32]
    option_attributes:
        type: [complex, sc16, byte, s32]
    hide: part
-   id: otw
    label: Device Format
    dtype: enum
    options: [sc16, sc8, u8]
    option_labels: [Complex int16, Complex int8, Byte]
-   id: block_index
    label: FIFO Select
    category: RFNoC Config
    dtype: int
    default: '-1'
    hide: ${ ('part' if int(block_index) < 0 else 'none') }
-   id: device_index
    label: Device Select
    category: RFNoC Config
    dtype: int
    default: '-1'
    hide: ${ ('part' if int(device_index) < 0 else 'none') }
-   id: base_addr_0
    label: Base Address (Port 1)
    category: RFNoC Config
    dtype: int
    default: '0'
-   id: depth_0
    label: Depth (Port 1)
    category: RFNoC Config
    dtype: int
    default: '33554432'
-   id: base_addr_1
    label: Base Address (Port 2)
    category: RFNoC Config
    dtype: int
    default: '33554432'
    hide: ${ ('part' if int(num_chans) < 2 else 'none') }
-   id: depth_1
    label: Depth (Port 2)
    category: RFNoC Config
    dtype: int
    default: '33554432'
    hide: ${ ('part' if int(num_chans) < 2 else 'none') }
-   id: fpga_module_name
    label: FPGA Module Name
    category: RFNoC Config
    dtype: string
    default: noc_block_axi_dma_fifo
    hide: all
-   id: grvlen
    label: Force Vector Length
    dtype: int
    default: '1'
    hide: ${ 'part' if grvlen == 1 else 'none' }

inputs:
-   domain: rfnoc
    dtype: ${ type.type }
    vlen: ${ grvlen }
    multiplicity: ${ num_chans }

outputs:
-   domain: rfnoc
    dtype: ${ type.type }
    vlen: ${ grvlen }
    multiplicity: ${ num_chans }

templates:
    imports: import ettus
    make: |
        ettus.rfnoc_generic(
            self.device3,
            uhd.stream_args( # TX Stream Args
                cpu_format="${type}",
                otw_format="${otw}",
                args="gr_vlen={0},{1}".format(${grvlen}, "" if ${grvlen} == 1 else "spp={0}".format(${grvlen})),
            ),
            uhd.stream_args( # RX Stream Args
                cpu_format="${type}",
                otw_format="${otw}",
                args="gr_vlen={0},{1}".format(${grvlen}, "" if ${grvlen} == 1 else "spp={0}".format(${grvlen})),
            ),
            "DmaFIFO", ${block_index}, ${device_index},
        )
        self.${id}.set_arg_int("base_addr", ${base_addr_0}, 0)
        self.${id}.set_arg_int("depth", ${depth_0}, 0)
        self.${id}.set_arg_int("base_addr", ${base_addr_1}, 1)
        self.${id}.set_arg_int("depth", ${depth_1}, 1)

file_format: 1
